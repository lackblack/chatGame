<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Chat History Game</title>
  <style>
    /* Your CSS styles can go here */
  </style>
</head>

<body>
  <h1>Guess Who Said It?</h1>
  <div id="quote-container">
    <p id="quote"></p>
    <div id="options"></div>
  </div>

  <div id="conversation"></div>

  <script>
    // Function to fetch chat history from a text file
    async function fetchChatHistory() {
      try {
        const response = await fetch('chat_history.txt'); // Replace 'chat_history.txt' with your file path
        const data = await response.text();
        return data;
      } catch (error) {
        console.error('Error fetching chat history:', error);
        return null;
      }
    }

    // Function to parse the chat data
    function parseChatData(chatText) {
      const messages = chatText.split('\n');
      const parsedMessages = [];

      messages.forEach(message => {
        const [timestamp, content] = message.split(' - ');
        if (content) {
          const [sender, messageContent] = content.split(': ');
          if (sender && messageContent) {
            parsedMessages.push({ sender: sender.trim(), message: messageContent.trim() });
          }
        }
      });

      return parsedMessages;
    }

    // Function to display the quote and options
    function displayQuoteAndOptions(chatHistory) {
      const quoteContainer = document.getElementById('quote');
      const optionsContainer = document.getElementById('options');

      // Get a random quote from the chat history
      const randomIndex = Math.floor(Math.random() * chatHistory.length);
      const randomQuote = chatHistory[randomIndex];

      // Display the quote
      quoteContainer.textContent = randomQuote.message;

      // Create an array of friend names
      const friends = chatHistory.map(chat => chat.sender);
      // Remove duplicates from the array
      const uniqueFriends = [...new Set(friends)];

      // Shuffle friend names for options
      const shuffledFriends = uniqueFriends.sort(() => Math.random() - 0.5);

      // Display options as buttons
      optionsContainer.innerHTML = '';
      shuffledFriends.forEach(friend => {
        const optionButton = document.createElement('button');
        optionButton.textContent = friend;
        optionButton.addEventListener('click', () => checkAnswer(friend, randomQuote.sender));
        optionsContainer.appendChild(optionButton);
      });
    }

    // Function to display the conversation around the selected quote
    function displayConversationAroundQuote(chatHistory, currentQuoteIndex) {
      const conversationContainer = document.getElementById('conversation');
      conversationContainer.innerHTML = '';

      const messagesToShow = 4;
      const startIndex = Math.max(0, currentQuoteIndex - messagesToShow);
      const endIndex = Math.min(chatHistory.length - 1, currentQuoteIndex + messagesToShow);

      for (let i = startIndex; i <= endIndex; i++) {
        const message = chatHistory[i];
        const messageElement = document.createElement('p');
        messageElement.innerHTML = `<strong>${message.sender}</strong>: ${message.message}`;
        conversationContainer.appendChild(messageElement);
      }
    }

    // Function to check the answer
    async function checkAnswer(selectedFriend, correctFriend) {
      if (selectedFriend === correctFriend) {
        alert('Correct! You guessed it right!');
        // Increase score or perform any other actions for a correct answer
      } else {
        alert(`Oops! The correct answer was ${correctFriend}. Try again!`);
        // Handle incorrect guess (optional)
      }

      // Display the conversation around the quote
      const chatText = await fetchChatHistory(); // Refetch chat history
      const parsedChatHistory = parseChatData(chatText);
      const currentQuoteIndex = Math.floor(Math.random() * parsedChatHistory.length);
      displayConversationAroundQuote(parsedChatHistory, currentQuoteIndex);
    }

    // Load chat history and parse when the page loads
    window.onload = async () => {
      const chatText = await fetchChatHistory();
      if (chatText) {
        const parsedChatHistory = parseChatData(chatText);
        console.log(parsedChatHistory); // Check if the data is parsed correctly
        displayQuoteAndOptions(parsedChatHistory); // Start the game with the parsed chat history
      } else {
        console.error('Failed to load chat history.');
      }
    };
  </script>
</body>
</html>
