<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Chat History Game</title>
  <style>
    /* Your CSS styles for the WhatsApp-like chat interface */
    body {
      font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
      background-color: #ededed;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    .chat-window {
      width: 80%; /* Adjusted width for responsiveness */
      max-width: 500px;
      background-color: #fff;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      text-align: center; /* Center alignment for buttons */
    }
    .chat-header {
      background-color: #075e54;
      color: #fff;
      padding: 12px;
      text-align: center;
      font-weight: bold;
    }
    .chat-body {
      max-height: 400px;
      overflow-y: auto;
      padding: 10px;
    }
    .message {
      margin: 20px 0; /* Increased margin around the quote */
      padding: 8px;
      border-radius: 8px;
      display: inline-block;
    }
    .user-message {
      background-color: #dcf8c6;
    }
    .quote-bubble {
      background-color: #dcf8c6;
      border-radius: 10px;
      padding: 10px;
      display: inline-block;
      margin-bottom: 20px; /* Added space below the quote */
    }
    .conversation-bubble {
      background-color: #dcf8c6; /* Updated background color */
      border-radius: 10px; /* Updated border radius */
      padding: 10px; /* Updated padding */
      margin: 5px 0;
      display: inline-block;
      max-width: 80%; /* Adjusted max-width */
    }
    .correct-answer {
      color: green;
      font-weight: bold;
    }
    .wrong-answer {
      color: red;
      font-weight: bold;
    }
    .options-btn {
      margin-right: 10px;
      margin-bottom: 10px;
      background-color: #25d366; /* WhatsApp-style button color */
      color: #fff; /* Text color */
      border: none;
      border-radius: 5px;
      padding: 8px 16px;
      cursor: pointer;
    }
    #score {
      margin-top: 20px;
      text-align: center; /* Center alignment for score */
    }
    #nextBtn,
    #newGameBtn {
      background-color: #25d366; /* WhatsApp-style button color */
      color: #fff; /* Text color */
      border: none;
      border-radius: 5px;
      padding: 8px 16px;
      cursor: pointer;
      margin-top: 10px;
      display: block;
      margin: 0 auto; /* Center the buttons */
    }
  </style>
</head>

<body>
  <div class="chat-window">
    <div class="chat-header">Guess Who Said It?v17</div>
    <div class="chat-body" id="conversation"></div>
    <div class="message" id="quote-container">
      <div class="quote-bubble" id="quote"></div>
      <div id="options"></div>
    </div>
    <button id="nextBtn" onclick="nextQuote()">Next</button>
    <button id="newGameBtn" onclick="startNewGame()">New Game</button>
    <p id="score">Score: <span id="scoreValue">0</span></p>
  </div>

  <script>
    let score = 0;
    let parsedChatHistory = [];

    // Function to fetch chat history from a text file
    async function fetchChatHistory() {
      try {
        const response = await fetch('chat_history.txt'); // Replace 'chat_history.txt' with your file path
        const data = await response.text();
        return data;
      } catch (error) {
        console.error('Error fetching chat history:', error);
        return null;
      }
    }

    // Function to parse the chat data
    function parseChatData(chatText) {
      const messages = chatText.split('\n');
      const parsedMessages = [];

      messages.forEach(message => {
        const [timestamp, content] = message.split(' - ');
        if (content) {
          const [sender, messageContent] = content.split(': ');
          if (sender && messageContent) {
            parsedMessages.push({ sender: sender.trim(), message: messageContent.trim() });
          }
        }
      });

      return parsedMessages;
    }

    // Function to display the quote and options
    function displayQuoteAndOptions(chatHistory) {
      const quoteContainer = document.getElementById('quote');
      const optionsContainer = document.getElementById('options');
      const nextBtn = document.getElementById('nextBtn');
      const newGameBtn = document.getElementById('newGameBtn');

      // Get a random quote from the chat history
      const randomIndex = Math.floor(Math.random() * chatHistory.length);
      const randomQuote = chatHistory[randomIndex];

      // Display the quote
      quoteContainer.innerHTML = `<strong>${randomQuote.message}</strong>`;

      // Create an array of friend names
      const friends = chatHistory.map(chat => chat.sender);
      // Remove duplicates from the array
      const uniqueFriends = [...new Set(friends)];

      // Shuffle friend names for options
      const shuffledFriends = uniqueFriends.sort(() => Math.random() - 0.5);

      // Display options as buttons
      optionsContainer.innerHTML = '';
      shuffledFriends.forEach(friend => {
        const optionButton = document.createElement('button');
        optionButton.textContent = friend;
        optionButton.addEventListener('click', () => checkAnswer(friend, randomQuote.sender, chatHistory, randomIndex));
        optionsContainer.appendChild(optionButton);
      });

      nextBtn.style.display = 'none';
      newGameBtn.style.display = 'none';
    }

    // Function to display the conversation around the selected quote
    function displayConversationAroundQuote(chatHistory, quoteIndex) {
      const conversationContainer = document.getElementById('conversation');
      conversationContainer.innerHTML = '';

      const messagesToShow = 3;
      const startIndex = Math.max(0, quoteIndex - messagesToShow);
      const endIndex = Math.min(chatHistory.length - 1, quoteIndex + messagesToShow);

      for (let i = startIndex; i <= endIndex; i++) {
        const message = chatHistory[i];
        const messageElement = document.createElement('div');
        const senderContent = `<strong>${message.sender}: ${message.message}</strong>`;
        messageElement.innerHTML = `<div class="conversation-bubble">${i === quoteIndex ? senderContent : message.sender ? senderContent : message.message}</div>`;
        conversationContainer.appendChild(messageElement);
      }
    }

    // Function to check the answer
    function checkAnswer(selectedFriend, correctFriend, chatHistory, quoteIndex) {
      const scoreValue = document.getElementById('scoreValue');
      const conversationContainer = document.getElementById('conversation');
      const nextBtn = document.getElementById('nextBtn');
      const newGameBtn = document.getElementById('newGameBtn');

      if (selectedFriend === correctFriend) {
        score++;
        scoreValue.textContent = score;
        displayConversationAroundQuote(chatHistory, quoteIndex);
        conversationContainer.innerHTML += `<div class="conversation-bubble correct-answer">Correct! You guessed it right!</div>`;
        nextBtn.style.display = 'block';
      } else {
        score = 0;
        scoreValue.textContent = score;
        displayConversationAroundQuote(chatHistory, quoteIndex);
        conversationContainer.innerHTML += `<div class="conversation-bubble wrong-answer">Oops! The correct answer was ${correctFriend}. Game over!</div>`;
        newGameBtn.style.display = 'block';
      }
    }

    // Function to start a new quote game
    function nextQuote() {
      const nextBtn = document.getElementById('nextBtn');
      const newGameBtn = document.getElementById('newGameBtn');
      const conversationContainer = document.getElementById('conversation');

      nextBtn.style.display = 'none';
      newGameBtn.style.display = 'none';
      conversationContainer.innerHTML = ''; // Clear conversation container
      displayQuoteAndOptions(parsedChatHistory);
    }

    // Function to start a new game
    function startNewGame() {
      const scoreValue = document.getElementById('scoreValue');
      const conversationContainer = document.getElementById('conversation');
      const nextBtn = document.getElementById('nextBtn');
      const newGameBtn = document.getElementById('newGameBtn');

      score = 0;
      scoreValue.textContent = score;
      nextBtn.style.display = 'none';
      newGameBtn.style.display = 'none';
      conversationContainer.innerHTML = ''; // Clear conversation container
      startGame();
    }

    // Function to load chat history and parse when the page loads
    async function startGame() {
      const chatText = await fetchChatHistory();
      if (chatText) {
        parsedChatHistory = parseChatData(chatText);
        displayQuoteAndOptions(parsedChatHistory);
      } else {
        console.error('Failed to load chat history.');
      }
    }

    window.onload = startGame;
  </script>
</body>
</html>
