<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Chat History Game</title>
  <style>
    /* Your CSS styles can go here */
    #score {
      position: absolute;
      top: 10px;
      right: 10px;
    }
  </style>
</head>

<body>
  <h1>Guess Who Said It?</h1>
  <div id="quote-container">
    <p id="quote"></p>
    <div id="options"></div>
  </div>

  <div id="conversation" style="display: none;"></div>
  <p id="score">Score: <span id="scoreValue">0</span></p>
  <button id="nextButton" style="display: none;">Next</button>
  <button id="newGameButton" style="display: none;">New Game</button>

  <script>
    let score = 0;
    let currentQuoteIndex = -1;

    // Function to fetch chat history from a text file
    async function fetchChatHistory() {
      try {
        const response = await fetch('chat_history.txt'); // Replace 'chat_history.txt' with your file path
        const data = await response.text();
        return data;
      } catch (error) {
        console.error('Error fetching chat history:', error);
        return null;
      }
    }

    // Function to parse the chat data
    function parseChatData(chatText) {
      const messages = chatText.split('\n');
      const parsedMessages = [];

      messages.forEach(message => {
        const [timestamp, content] = message.split(' - ');
        if (content) {
          const [sender, messageContent] = content.split(': ');
          if (sender && messageContent) {
            parsedMessages.push({ sender: sender.trim(), message: messageContent.trim() });
          }
        }
      });

      return parsedMessages;
    }

    // Function to display the quote and options
    function displayQuoteAndOptions(chatHistory) {
      const quoteContainer = document.getElementById('quote');
      const optionsContainer = document.getElementById('options');
      const nextButton = document.getElementById('nextButton');
      const newGameButton = document.getElementById('newGameButton');

      currentQuoteIndex = Math.floor(Math.random() * chatHistory.length);
      const randomQuote = chatHistory[currentQuoteIndex];

      // Display the quote
      quoteContainer.innerHTML = `<strong>${randomQuote.message}</strong>`;

      // Create an array of friend names
      const friends = chatHistory.map(chat => chat.sender);
      // Remove duplicates from the array
      const uniqueFriends = [...new Set(friends)];

      // Shuffle friend names for options
      const shuffledFriends = uniqueFriends.sort(() => Math.random() - 0.5);

      // Display options as buttons
      optionsContainer.innerHTML = '';
      shuffledFriends.forEach(friend => {
        const optionButton = document.createElement('button');
        optionButton.textContent = friend;
        optionButton.addEventListener('click', () => checkAnswer(friend, randomQuote.sender, chatHistory));
        optionsContainer.appendChild(optionButton);
      });

      // Hide the 'Next' and 'New Game' buttons
      nextButton.style.display = 'none';
      newGameButton.style.display = 'none';
      document.getElementById('conversation').style.display = 'none';
    }

    // Function to display the conversation around the selected quote
    function displayConversationAroundQuote(chatHistory, quoteIndex) {
      const conversationContainer = document.getElementById('conversation');
      conversationContainer.innerHTML = '';

      const messagesToShow = 3;
      const startIndex = Math.max(0, quoteIndex - messagesToShow);
      const endIndex = Math.min(chatHistory.length - 1, quoteIndex + messagesToShow);

      for (let i = startIndex; i <= endIndex; i++) {
        const message = chatHistory[i];
        const messageElement = document.createElement('p');
        if (i === quoteIndex) {
          messageElement.innerHTML = `<strong>${message.sender}: ${message.message}</strong>`;
        } else {
          messageElement.innerHTML = `${message.sender}: ${message.message}`;
        }
        conversationContainer.appendChild(messageElement);
      }
    }

    // Function to check the answer
    function checkAnswer(selectedFriend, correctFriend, chatHistory) {
      const nextButton = document.getElementById('nextButton');
      const newGameButton = document.getElementById('newGameButton');
      const scoreValue = document.getElementById('scoreValue');

      if (selectedFriend === correctFriend) {
        alert('Correct! You guessed it right!');
        score++;
        scoreValue.textContent = score;
        nextButton.style.display = 'block';
      } else {
        alert('Game Over! Incorrect guess.');
        score = 0;
        scoreValue.textContent = score;
        newGameButton.style.display = 'block';
      }
    }

    // Function to load a new quote for guessing
    function loadNewQuote(chatHistory) {
      const scoreValue = document.getElementById('scoreValue');
      displayQuoteAndOptions(chatHistory);
      displayConversationAroundQuote(chatHistory, currentQuoteIndex);
      scoreValue.textContent = score;
    }

    // Function to start a new game
    function startNewGame(chatHistory) {
      const scoreValue = document.getElementById('scoreValue');
      score = 0;
      scoreValue.textContent = score;
      displayQuoteAndOptions(chatHistory);
      displayConversationAroundQuote(chatHistory, currentQuoteIndex);
    }

    // Load chat history and parse when the page loads
    window.onload = async () => {
      const chatText = await fetchChatHistory();
      if (chatText) {
        const parsedChatHistory = parseChatData(chatText);
        displayQuoteAndOptions(parsedChatHistory);
        displayConversationAroundQuote(parsedChatHistory, currentQuoteIndex);

        document.getElementById('nextButton').addEventListener('click', () => loadNewQuote(parsedChatHistory));
        document.getElementById('newGameButton').addEventListener('click', () => startNewGame(parsedChatHistory));
      } else {
        console.error('Failed to load chat history.');
      }
    };
  </script>
</body>
</html>
